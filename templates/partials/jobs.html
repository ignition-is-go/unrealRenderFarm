<section class="jobs-section">
    <h2>Jobs
        {% if requests %}
        <button class="btn-delete-all"
                hx-delete="/api/delete-all"
                hx-confirm="Delete all {{ requests|length }} jobs?"
                hx-swap="none">Delete All</button>
        {% endif %}
    </h2>
    {% if requests %}
    <table>
        <thead>
            <tr>
                <th>UID</th>
                <th>Name</th>
                <th>Worker</th>
                <th>Status</th>
                <th>Progress</th>
                <th>ETA</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for job in requests %}
            <tr class="job-row status-{{ job.status|replace(' ', '-') }}">
                <td class="job-uid">{{ job.uid }}</td>
                <td>{{ job.name }}</td>
                <td>{{ job.worker or '-' }}</td>
                <td>
                    <span class="status-badge {{ job.status|replace(' ', '-') }}">
                        {{ job.status }}
                        {% if job.retry_count and job.retry_count > 0 %}
                        <span class="retry-count">({{ job.retry_count }})</span>
                        {% endif %}
                    </span>
                    {% if job.error_message %}
                    <div class="error-detail" title="{{ job.error_message }}">
                        {{ job.error_message[:50] }}{% if job.error_message|length > 50 %}...{% endif %}
                    </div>
                    {% endif %}
                </td>
                <td>
                    {% if job.status == 'in progress' %}
                    {% if job.progress == 0 %}
                    <span class="initializing-text">Initializing...</span>
                    {% else %}
                    <div class="progressContainer">
                        <div class="progressBar" style="width: {{ job.progress }}%">{{ job.progress }}%</div>
                    </div>
                    {% endif %}
                    {% elif job.status == 'finished' %}
                    <span class="completed-text">100%</span>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>
                    {% if job.status == 'in progress' %}
                    {{ job.time_estimate or 'Calculating...' }}
                    {% elif job.completed_at %}
                    Completed {{ job.completed_at[:10] }}
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td class="actions">
                    {% if job.status in ['errored', 'cancelled'] %}
                    <button class="btn-retry"
                            hx-post="/api/retry/{{ job.uid }}"
                            hx-swap="none">Retry</button>
                    {% endif %}
                    {% if job.status not in ['finished', 'cancelled', 'failed'] %}
                    <button class="btn-cancel"
                            hx-post="/api/cancel/{{ job.uid }}"
                            hx-swap="none">Cancel</button>
                    {% endif %}
                    {% if job.status in ['finished', 'cancelled', 'failed', 'errored'] %}
                    <button class="btn-delete"
                            hx-delete="/api/delete/{{ job.uid }}"
                            hx-target="closest tr"
                            hx-swap="delete">Delete</button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-data">No jobs in queue</p>
    {% endif %}
</section>
