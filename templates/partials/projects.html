<section class="projects-section">
    <h2>Submit Jobs</h2>
    {% if projects %}
    {% for project in projects %}
    <div class="project-card">
        <div class="project-header">
            <span class="project-name">{{ project.name }}</span>
            <span class="project-info">{{ project.sequences|length }} sequences</span>
        </div>

        <form class="sequence-form" hx-post="/api/submit-selected/{{ project._file }}" hx-swap="none"
              hx-on::after-request="if(event.detail.successful) { this.reset(); this.querySelectorAll('input:checked').forEach(c => c.checked = false); }">
            <div class="sequence-controls">
                <label class="select-all">
                    <input type="checkbox" onchange="this.closest('form').querySelectorAll('.seq-checkbox').forEach(c => c.checked = this.checked)">
                    Select All
                </label>
                <button type="submit" class="btn-submit">Submit Selected</button>
            </div>

            <div class="sequence-list">
                {% for seq in project.sequences %}
                {% set seq_name = seq.rstrip('/').split('/')[-1].split('.')[0] %}
                <label class="sequence-item">
                    <input type="checkbox" name="sequences" value="{{ seq }}" class="seq-checkbox">
                    <span class="seq-name">{{ seq_name }}</span>
                </label>
                {% endfor %}
            </div>
        </form>
    </div>
    {% endfor %}
    {% else %}
    <p class="no-data">No projects found in /projects/*.json</p>
    {% endif %}
</section>
