---
# Configure Windows auto-logon for headless GPU rendering
# Usage: ansible-playbook -i inventory.yml playbooks/setup-autologon.yml
#
# This ensures an interactive desktop session is always available
# Required for Unreal Engine to access the GPU

- name: Configure Auto-Logon
  hosts: render_nodes
  gather_facts: false

  tasks:
    - name: Set auto-logon registry keys
      ansible.windows.win_regedit:
        path: HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
        name: "{{ item.name }}"
        data: "{{ item.data }}"
        type: string
      loop:
        - { name: 'AutoAdminLogon', data: '1' }
        - { name: 'DefaultUserName', data: 'Administrator' }
        - { name: 'DefaultPassword', data: '{{ ansible_password }}' }
        - { name: 'DefaultDomainName', data: '' }

    - name: Disable lock screen
      ansible.windows.win_regedit:
        path: HKLM:\SOFTWARE\Policies\Microsoft\Windows\Personalization
        name: NoLockScreen
        data: 1
        type: dword

    - name: Report completion
      ansible.builtin.debug:
        msg: "Auto-logon configured. Reboot VMs to activate."
